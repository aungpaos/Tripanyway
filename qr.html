<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
</head>

<body class="bg-gray-100 text-gray-900">

  <div class="max-w-6xl mx-auto px-4 py-6">
    <!-- Header -->
    <div class="mb-6">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-white shadow-xl">
        <div class="flex items-center gap-3 mb-2">
          <span>üì±</span>
          <h2 class="text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code</h2>
        </div>
        <p class="text-indigo-100">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô TT Coin</p>
      </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-6">
      <!-- Create Form -->
      <div class="bg-white p-6 rounded-xl shadow-md">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡πÉ‡∏´‡∏°‡πà</h3>
        <form id="qrForm" class="space-y-4">
          <div>
            <label for="location" class="block font-semibold mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á *</label>
            <input id="location" type="text" class="w-full border rounded-lg p-2" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á" required />
          </div>

          <div>
            <label for="description" class="block font-semibold mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
            <input id="description" type="text" class="w-full border rounded-lg p-2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" />
          </div>

          <div>
            <label for="coins" class="block font-semibold mb-1">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</label>
            <input id="coins" type="number" class="w-full border rounded-lg p-2" value="499" min="1" />
            <p class="text-xs text-gray-500">‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 499 coin (‚âà 6.65 ‡∏ö‡∏≤‡∏ó)</p>
          </div>

          <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
          </button>
        </form>
      </div>

      <!-- QR Code List -->
      <div class="bg-white p-6 rounded-xl shadow-md">
        <h3 class="text-xl font-bold mb-4">üìã QR Code ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="qrList" class="space-y-3 max-h-[500px] overflow-y-auto">
          <p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ QR Code</p>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div class="bg-white p-6 rounded-xl shadow-md mt-6">
      <h3 class="text-xl font-bold mb-4">üß≠ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
      <ol class="list-decimal pl-6 space-y-2">
        <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code‚Äù</li>
        <li>‡∏Å‡∏î ‚Äú‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û QR</li>
        <li>‡∏ô‡∏≥ QR ‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</li>
        <li>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô TT Coin</li>
      </ol>
    </div>
  </div>

  <script>
    const form = document.getElementById("qrForm");
    const qrList = document.getElementById("qrList");

    let qrCodes = JSON.parse(localStorage.getItem("qrCodes") || "[]");

    function saveToLocal() {
      localStorage.setItem("qrCodes", JSON.stringify(qrCodes));
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const location = document.getElementById("location").value.trim();
      const description = document.getElementById("description").value.trim();
      const coins = parseInt(document.getElementById("coins").value) || 499;

      if (!location) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
        return;
      }

      // encode ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô base64
      const locationBase64 = btoa(unescape(encodeURIComponent(location)));
      const randomStr = Math.random().toString(36).substr(2, 5).toUpperCase();
      const code = `ANYWAY-${coins}-${locationBase64}-${randomStr}`;

      const qrData = {
        id: Date.now(),
        location,
        description,
        coins,
        code,
        isActive: true,
        scanCount: 0
      };

      qrCodes.push(qrData);
      saveToLocal();
      renderQRList();
      form.reset();
      alert("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    });

    function renderQRList() {
      if (qrCodes.length === 0) {
        qrList.innerHTML = `<p class="text-gray-500 text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ QR Code</p>`;
        return;
      }

      qrList.innerHTML = qrCodes.map(qr => `
        <div class="p-4 border rounded-lg ${qr.isActive ? 'bg-white' : 'bg-gray-100 opacity-60'}">
          <div class="flex justify-between items-start mb-2">
            <div>
              <h4 class="font-bold text-lg">${qr.location}</h4>
              <p class="text-sm text-gray-600">${qr.description || ''}</p>
            </div>
            <span class="text-sm px-2 py-1 rounded ${qr.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-200'}">
              ${qr.isActive ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏õ‡∏¥‡∏î'}
            </span>
          </div>
          <div class="flex gap-2 mb-2">
            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">${qr.coins} coin</span>
            <span class="border px-2 py-1 rounded text-sm">‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß ${qr.scanCount} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
          </div>
          <div class="flex gap-2 items-center mb-3">
            <code class="bg-gray-100 px-2 py-1 rounded flex-1 text-xs">${qr.code}</code>
            <button onclick="copyCode('${qr.code}')" class="text-blue-600 hover:text-blue-800 text-sm">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          </div>
          <div id="qrcode-${qr.id}" class="mb-3 flex justify-center"></div>
          <div class="flex gap-2">
            <button onclick="downloadQRCode(${qr.id})" class="flex-1 bg-emerald-600 text-white px-2 py-1 rounded hover:bg-emerald-700">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
            <button onclick="toggleQR(${qr.id})" class="border px-2 py-1 rounded text-sm">${qr.isActive ? '‡∏õ‡∏¥‡∏î' : '‡πÄ‡∏õ‡∏¥‡∏î'}</button>
            <button onclick="deleteQR(${qr.id})" class="border px-2 py-1 rounded text-red-600 text-sm">‡∏•‡∏ö</button>
          </div>
        </div>
      `).join("");

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏à‡∏£‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢ qrcode.js
      qrCodes.forEach(qr => {
        const qrContainer = document.getElementById(`qrcode-${qr.id}`);
        if (qrContainer && qrContainer.childElementCount === 0) {
          new QRCode(qrContainer, {
            text: qr.code,
            width: 120,
            height: 120
          });
        }
      });
    }

    function copyCode(code) {
      navigator.clipboard.writeText(code);
      alert("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: " + code);
    }

    function toggleQR(id) {
      const qr = qrCodes.find(q => q.id === id);
      qr.isActive = !qr.isActive;
      saveToLocal();
      renderQRList();
    }

    function deleteQR(id) {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö QR Code ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        qrCodes = qrCodes.filter(q => q.id !== id);
        saveToLocal();
        renderQRList();
      }
    }

    function downloadQRCode(id) {
      const qrContainer = document.getElementById(`qrcode-${id}`);
      const img = qrContainer.querySelector("img") || qrContainer.querySelector("canvas");
      const qr = qrCodes.find(q => q.id === id);
      const link = document.createElement("a");
      link.download = `QR-${qr.location}-${qr.code}.png`;
      link.href = img.src || img.toDataURL();
      link.click();
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
    renderQRList();
  </script>

</body>
</html>